jQuery(document).ready(function(){if(typeof ol!=="undefined"){var f=[];var d=[];var a=[];var e=[];var c=[];ep_proj_source=new ol.proj.Projection({code:"EPSG:4326"});ep_proj_destination=new ol.proj.Projection({code:"EPSG:900913"});jQuery("a.event_link.gps").click(function(){if(jQuery(this).parent().data("latitude")!==undefined&&jQuery(this).parent().data("longitude")!==undefined){var l=jQuery(this).parent().data("latitude");var m=jQuery(this).parent().data("longitude");var i=jQuery(this).parent().data("marker");var n=jQuery(this).parent().data("id");var j=16;var h="event_map"+n;var g=new ol.proj.transform([m,l],ep_proj_source,ep_proj_destination);if(jQuery("#"+h).length===0){jQuery(this).parent().append('<div id="'+h+'-wrap"><div id="'+h+'" class="event_map"></div></div>');jQuery("#"+h+"-wrap").css({height:"400px",margin:"auto",clear:"both"}).animate({height:"toggle"},1);d[h]=new ol.source.Vector();f[h]=new ol.Map({target:h,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:eventpost_params.maptiles[eventpost_params.defaulttile]["urls"]})}),new ol.layer.Vector({source:d[h]})],view:new ol.View({center:g,zoom:12})});f[h].addControl(new ol.control.Zoom());var k=new ol.Feature({geometry:new ol.geom.Point(g)});if(c[i]==undefined){c[i]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:i}))})}k.setStyle(c[i]);d[h].addFeature(k)}jQuery("#"+h+"-wrap").animate({height:"toggle"},1000,function(){f[h].getView().setCenter(g)});return false}});jQuery(".event_geolist").each(function(){jQuery(this).children(".event_item").hide();var j=jQuery(this).attr("id");var i="event_map_all"+j;var l="event_markersall"+j;var k=jQuery(this).data("width");var h=jQuery(this).data("height");var g=jQuery(this).data("tile");jQuery(this).append('<div id="'+i+'" class="event_map map"></div><div id="'+i+'-popup" class="event_map_popup"></div>');css={margin:"auto",clear:"both"};if(k!=="auto"){css.width=k}if(h!=="auto"){css.height=h}jQuery("#"+i).css(css);d[i]=new ol.source.Vector();a[i]=jQuery("#"+i+"-popup");e[i]=new ol.Overlay({element:a[i],positioning:"bottom-center",stopEvent:false});f[i]=new ol.Map({target:i,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:eventpost_params.maptiles[g]["urls"]})}),new ol.layer.Vector({source:d[i]})],view:new ol.View({center:[0,0],zoom:12,maxZoom:18}),overlays:[e[i]]});f[i].addControl(new ol.control.ZoomSlider());f[i].on("click",function(m){var n=f[i].forEachFeatureAtPixel(m.pixel,function(s,r){return s});if(n){a[i].hide(0);view=f[i].getView();var p=n.getGeometry();var q=p.getCoordinates();var o=ol.animation.pan({duration:1000,source:view.getCenter()});f[i].beforeRender(o);view.setCenter(q);e[i].setPosition(q);html_output='<a href="'+n.get("link")+'">'+(n.get("thumbnail")!=""&&n.get("thumbnail")!=undefined?'<img src="'+n.get("thumbnail")+'">':"")+"<strong>"+n.get("name")+"</strong><br><time>"+n.get("date")+"</time><br><address>"+n.get("address")+"</address>"+(n.get("desc")!=""&&n.get("desc")!=undefined?"<p>"+n.get("desc")+"</p>":"")+"</a>";a[i].delay(500).html(html_output).show(500)}else{a[i].hide(200)}});jQuery(this).find("address").each(function(){var p=parseFloat(jQuery(this).data("latitude"));var q=parseFloat(jQuery(this).data("longitude"));if(p!=undefined&&q!=undefined){var n=jQuery(this).parent().parent();var m=jQuery(this).data("marker");var r=jQuery(this).data("id");coords=new ol.proj.transform([q,p],ep_proj_source,ep_proj_destination);obj={geometry:new ol.geom.Point(coords),name:n.find("h5").text(),address:jQuery(this).html(),date:n.find("time").text(),link:n.find("a").attr("href"),desc:n.find(".event_exerpt").html()};if(n.find("img").length>0){obj.thumbnail=n.find("img").attr("src")}var o=new ol.Feature(obj);if(c[m]==undefined){c[m]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:m}))})}o.setStyle(c[m]);d[i].addFeature(o)}});f[i].getView().fitExtent(d[i].getExtent(),f[i].getSize())})}function b(){jQuery(".eventpost_cal_bt").click(function(){var g=jQuery(this).parent().parent().parent().parent().parent();jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:g.data("cat"),mf:g.data("mf"),dp:g.data("dp")},function(h){g.html(h);b()})});jQuery(".eventpost_cal_link").click(function(){var g=jQuery(this).parent().parent().parent().parent().parent();g.find(".eventpost_cal_list").fadeOut(function(){jQuery(this).remove()});jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendarDate",date:jQuery(this).data("date"),cat:g.data("cat"),mf:g.data("mf"),dp:g.data("dp")},function(h){g.append('<div class="eventpost_cal_list"><button class="eventpost_cal_close">x</button>'+h+"</div>");g.find(".eventpost_cal_list").hide(1).fadeIn(500);g.find(".eventpost_cal_close").click(function(){console.log("ggg");jQuery(this).parent().hide(500).remove()})})})}jQuery(".eventpost_calendar").each(function(){var g=jQuery(this);g.html('<img src="'+eventpost_params.imgpath+'cal-loader.gif" class="eventpost_cal_loader"/>');jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:jQuery(this).data("cat"),mf:jQuery(this).data("mf"),dp:jQuery(this).data("dp")},function(h){g.html(h);b()})})});