jQuery(document).ready(function(){function e(e,a,t,n,r,s,p,i){var o=new OpenLayers.Feature(a,t);o.closeBox=s,o.popupClass=n,o.data.popupContentHTML=r,o.data.icon=i,o.data.overflow=p?"auto":"hidden";var d=o.createMarker(),u=function(a){null==this.popup?(this.popup=this.createPopup(this.closeBox),e.addPopup(this.popup),this.popup.show()):this.popup.toggle(),currentPopup=this.popup,OpenLayers.Event.stop(a)};d.events.register("mousedown",o,u),a.addMarker(d)}function a(){jQuery(".eventpost_cal_bt").click(function(){var e=jQuery(this).parent().parent().parent().parent().parent();jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:e.data("cat"),mf:e.data("mf"),dp:e.data("dp")},function(t){e.html(t),a()})}),jQuery(".eventpost_cal_link").click(function(){var e=jQuery(this).parent().parent().parent().parent().parent();e.find(".eventpost_cal_list").fadeOut(function(){jQuery(this).remove()}),jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendarDate",date:jQuery(this).data("date"),cat:e.data("cat"),mf:e.data("mf"),dp:e.data("dp")},function(a){e.append('<div class="eventpost_cal_list"><button class="eventpost_cal_close">x</button>'+a+"</div>"),e.find(".eventpost_cal_list").hide(1).fadeIn(500),e.find(".eventpost_cal_close").click(function(){console.log("ggg"),jQuery(this).parent().hide(500).remove()})})})}jQuery("a.event_link.gps").click(function(){if(void 0!=jQuery(this).parent().data("latitude")&&void 0!=jQuery(this).parent().data("longitude")){var e=jQuery(this).parent().data("latitude"),a=jQuery(this).parent().data("longitude"),t=jQuery(this).parent().data("marker"),n=jQuery(this).parent().data("id"),r=16;if(0==jQuery("#event_map"+n).length){jQuery(this).parent().append('<div id="event_map'+n+'" class="event_map"></div>'),jQuery("#event_map"+n).css({width:"90%",height:"400px",margin:"auto",clear:"both"}).animate({height:"toggle"},1);var s=new OpenLayers.Projection("EPSG:4326"),p=new OpenLayers.Projection("EPSG:900913"),i=new OpenLayers.LonLat(a,e).transform(s,p);OpenLayers.ImgPath=eventpost_params.imgpath,map=new OpenLayers.Map("event_map"+n),map.addControl(new OpenLayers.Control.PanZoom);var o=new OpenLayers.Layer.OSM;map.addLayer(o);var d=new OpenLayers.Layer.Markers("event_markers"),u=new OpenLayers.Size(32,32),y=new OpenLayers.Pixel(-(u.w/2),-u.h),h=new Array;h[t]=new OpenLayers.Icon(t,u,y),map.addLayer(d),d.addMarker(new OpenLayers.Marker(i,h[t]))}return jQuery("#event_map"+n).animate({height:"toggle"},1e3,function(){map.setCenter(i,r)}),!1}});var t=new Array,n=new Array;jQuery(".event_geolist").each(function(){jQuery(this).children(".event_item").hide();var a=jQuery(this).attr("id"),r="event_map_all"+a,s="event_markersall"+a,p=jQuery(this).css("width"),i=jQuery(this).css("height"),o=jQuery(this).data("tile");jQuery(this).append('<div id="'+r+'" class="event_map"></div>'),jQuery("#"+r).css({width:p,height:i,margin:"auto",clear:"both"});if(OpenLayers.ImgPath=eventpost_params.imgpath,t[r]=new OpenLayers.Map(r),t[r].addControl(jQuery(this).hasClass("eventpost_widget")?new OpenLayers.Control.PanZoom:new OpenLayers.Control.PanZoomBar),""!=o&&eventpost_params.maptiles[o])var o=new OpenLayers.Layer.OSM(o,eventpost_params.maptiles[o].urls);else o=new OpenLayers.Layer.OSM;t[r].addLayer(o),n[s]=new OpenLayers.Layer.Markers(s),t[r].addLayer(n[s]);var d=new OpenLayers.Projection("EPSG:4326"),u=new OpenLayers.Projection("EPSG:900913"),y=new OpenLayers.Size(32,32),h=(new OpenLayers.Size(200,200),new OpenLayers.Pixel(-(y.w/2),-y.h)),l=new Array,c=!1,v=new OpenLayers.Bounds,m=OpenLayers.Class(OpenLayers.Popup.FramedCloud,{autoSize:!0});jQuery(this).find("address").each(function(){var a=jQuery(this).data("latitude"),p=jQuery(this).data("longitude");if(void 0!=a&&void 0!=p){var i=jQuery(this).data("marker"),o=(jQuery(this).data("id"),jQuery(this).parent().parent().find("h5").parent().wrap("<p>").parent().html()+jQuery(this).html()),j=jQuery(this).parent().parent().find("time").html();void 0!=j&&(o+="<p>"+j+"</p>"),c=new OpenLayers.LonLat(p,a).transform(d,u),void 0!=l[i]?icon_this=l[i].clone():(l[i]=new OpenLayers.Icon(i,y,h),icon_this=l[i]),e(t[r],n[s],c,m,o,!0,!1,icon_this),v.extend(c)}}),t[r].setCenter(v.getCenterLonLat(),t[r].getZoomForExtent(v,!1))}),jQuery(".eventpost_calendar").each(function(){var e=jQuery(this);e.html('<img src="'+eventpost_params.imgpath+'cal-loader.gif" class="eventpost_cal_loader"/>'),jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:jQuery(this).data("cat"),mf:jQuery(this).data("mf"),dp:jQuery(this).data("dp")},function(t){e.html(t),a()})})});