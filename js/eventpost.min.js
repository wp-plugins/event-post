jQuery(document).ready(function(){if(typeof ol!=="undefined"){ep_maps=[];ep_vectorSources=[];ep_pop_elements=[];ep_popups=[];ep_icons=[];ep_proj_source=new ol.proj.Projection({code:"EPSG:4326"});ep_proj_destination=new ol.proj.Projection({code:"EPSG:900913"});ep_interactions=eventpost_params.map_interactions;jQuery("a.event_link.gps").click(function(){if(jQuery(this).parent().data("latitude")!==undefined&&jQuery(this).parent().data("longitude")!==undefined){var g=jQuery(this).parent().data("latitude");var h=jQuery(this).parent().data("longitude");var d=jQuery(this).parent().data("marker");var i=jQuery(this).parent().data("id");var e=16;var c="event_map"+i;var b=new ol.proj.transform([h,g],ep_proj_source,ep_proj_destination);if(jQuery("#"+c).length===0){jQuery(this).parent().append('<div id="'+c+'-wrap"><div id="'+c+'" class="event_map"></div></div>');jQuery("#"+c+"-wrap").css({height:"400px",margin:"auto",clear:"both"}).animate({height:"toggle"},1);ep_vectorSources[c]=new ol.source.Vector();ep_maps[c]=new ol.Map({target:c,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:eventpost_params.maptiles[eventpost_params.defaulttile]["urls"]})}),new ol.layer.Vector({source:ep_vectorSources[c]})],view:new ol.View({center:b,zoom:12})});ep_maps[c].addControl(new ol.control.Zoom());ep_maps[c].addControl(new ol.control.Zoom());var f=new ol.Feature({geometry:new ol.geom.Point(b)});if(ep_icons[d]==undefined){ep_icons[d]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:d}))})}f.setStyle(ep_icons[d]);ep_vectorSources[c].addFeature(f)}jQuery("#"+c+"-wrap").animate({height:"toggle"},1000,function(){ep_maps[c].getView().setCenter(b)});return false}});jQuery(".event_geolist").each(function(){jQuery(this).children(".event_item").hide();var e=jQuery(this).attr("id");var d="event_map_all"+e;var g="event_markersall"+e;var f=jQuery(this).data("width");var c=jQuery(this).data("height");var b=jQuery(this).data("tile");var h=jQuery(this).data("disabled-interactions");jQuery(this).append('<div id="'+d+'" class="event_map map"></div><div id="'+d+'-popup" class="event_map_popup"></div>');css={margin:"auto",clear:"both"};if(f!=="auto"){css.width=f}if(c!=="auto"){css.height=c}jQuery("#"+d).css(css);ep_vectorSources[d]=new ol.source.Vector();ep_pop_elements[d]=jQuery("#"+d+"-popup");ep_popups[d]=new ol.Overlay({element:ep_pop_elements[d],positioning:"bottom-center",stopEvent:false});map_settings={target:d,layers:[new ol.layer.Tile({source:new ol.source.XYZ({urls:eventpost_params.maptiles[b]["urls"]})}),new ol.layer.Vector({source:ep_vectorSources[d]})],view:new ol.View({center:[0,0],zoom:12,maxZoom:18}),overlays:[ep_popups[d]]};ep_maps[d]=new ol.Map(map_settings);ep_maps[d].addControl(new ol.control.ZoomSlider());ep_maps[d].on("click",function(i){var j=ep_maps[d].forEachFeatureAtPixel(i.pixel,function(o,n){return o});if(j){ep_pop_elements[d].hide(0);view=ep_maps[d].getView();var l=j.getGeometry();var m=l.getCoordinates();var k=ol.animation.pan({duration:1000,source:view.getCenter()});ep_maps[d].beforeRender(k);view.setCenter(m);ep_popups[d].setPosition(m);html_output='<a href="'+j.get("link")+'">'+(j.get("thumbnail")!=""&&j.get("thumbnail")!=undefined?'<img src="'+j.get("thumbnail")+'">':"")+"<strong>"+j.get("name")+"</strong><br><time>"+j.get("date")+"</time><br><address>"+j.get("address")+"</address>"+(j.get("desc")!=""&&j.get("desc")!=undefined?"<p>"+j.get("desc")+"</p>":"")+"</a>";ep_pop_elements[d].delay(500).html(html_output).show(500)}else{ep_pop_elements[d].hide(200)}});jQuery(this).find("address").each(function(){var l=parseFloat(jQuery(this).data("latitude"));var m=parseFloat(jQuery(this).data("longitude"));if(l!=undefined&&m!=undefined){var j=jQuery(this).parent().parent();var i=jQuery(this).data("marker");var n=jQuery(this).data("id");coords=new ol.proj.transform([m,l],ep_proj_source,ep_proj_destination);obj={geometry:new ol.geom.Point(coords),name:j.find("h5").text(),address:jQuery(this).html(),date:j.find("time").text(),link:j.find("a").attr("href"),desc:j.find(".event_exerpt").html()};if(j.find("img").length>0){obj.thumbnail=j.find("img").attr("src")}var k=new ol.Feature(obj);if(ep_icons[i]==undefined){ep_icons[i]=new ol.style.Style({image:new ol.style.Icon(({anchor:[16,32],anchorXUnits:"pixels",anchorYUnits:"pixels",opacity:1,src:i}))})}k.setStyle(ep_icons[i]);ep_vectorSources[d].addFeature(k)}});ep_maps[d].getView().fit(ep_vectorSources[d].getExtent(),ep_maps[d].getSize());m_i=0;for(int_key in ep_interactions){console.log(ep_interactions[int_key]);if(h.indexOf(int_key+",")>-1){ep_maps[d].getInteractions().getArray()[m_i].setActive(false)}m_i++}})}function a(){jQuery(".eventpost_cal_bt").click(function(){var b=jQuery(this).parent().parent().parent().parent().parent();jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:b.data("cat"),mf:b.data("mf"),dp:b.data("dp")},function(c){b.html(c);a()})});jQuery(".eventpost_cal_link").click(function(){var b=jQuery(this).parent().parent().parent().parent().parent();b.find(".eventpost_cal_list").fadeOut(function(){jQuery(this).remove()});jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendarDate",date:jQuery(this).data("date"),cat:b.data("cat"),mf:b.data("mf"),dp:b.data("dp")},function(c){b.append('<div class="eventpost_cal_list"><button class="eventpost_cal_close">x</button>'+c+"</div>");b.find(".eventpost_cal_list").hide(1).fadeIn(500);b.find(".eventpost_cal_close").click(function(){jQuery(this).parent().hide(500).remove()})})})}jQuery(".eventpost_calendar").each(function(){var b=jQuery(this);b.html('<img src="'+eventpost_params.imgpath+'cal-loader.gif" class="eventpost_cal_loader"/>');jQuery.get(eventpost_params.ajaxurl,{action:"EventPostCalendar",date:jQuery(this).data("date"),cat:jQuery(this).data("cat"),mf:jQuery(this).data("mf"),dp:jQuery(this).data("dp")},function(c){b.html(c);a()})})});